# PRD: 업무 일정 자동화 시스템

## 문서 정보
- **작성일**: 2026-02-18
- **상태**: 계획 수립 완료 → 구현 대기
- **목표**: 어디서든 빠르게 업무를 입력하면 노션 DB에 자동 정리되는 24/7 시스템

---

## 1. 프로젝트 개요

### 1.1 문제 정의
- 노션에 할 일을 제대로 기입하려면 앱 열기 → DB 찾기 → 항목 생성 → 프로젝트 연결 → 날짜 설정 등 **5단계 이상** 소요
- 이동 중이나 다른 작업 중에는 이 과정이 번거로워 **기록을 건너뛰게 됨**
- 기록이 누락되면 업무 일정 관리 시스템 자체가 무용지물

### 1.2 해결 방향
```
빠른 입력 (텔레그램/구글캘린더) → n8n 자동 정리 → 노션 DB 체계화
```

### 1.3 핵심 원칙
- **비용 0원** (전 구간 무료 서비스 활용)
- **24시간 가동** (Oracle Cloud Free Tier)
- **입력은 3초 이내** (메시지 하나로 완료)
- **정리는 n8n이 100% 자동**

---

## 2. 시스템 아키텍처

### 2.1 전체 구성도
```
[입력 채널]                    [서버 - Oracle Cloud]              [데이터]

 텔레그램 봇 ──────────┐      ┌────────────────────┐
                        ├──→  │  n8n (Docker)        │ ──API──→ Notion
 구글 캘린더 ──────────┘      │  PostgreSQL (Docker) │           - 할 일 DB
                               │  Nginx (HTTPS)       │           - 프로젝트 DB
 https://n8n.도메인.com ──→   │  Let's Encrypt       │           - 캘린더 DB
   (웹 에디터 직접 접속)       └────────────────────┘           - 업무 카테고리 DB
                                        │
                                        ├── 매일 08:00 모닝브리핑 → 텔레그램
                                        └── 매일 10:00 밀린업무  → 텔레그램
```

### 2.2 인프라 스택 (전부 무료)
| 구성 요소 | 서비스 | 비용 |
|---|---|---|
| 서버 | Oracle Cloud Always Free (ARM 4코어/24GB) | 0원 |
| 도메인 | 기존 보유 도메인 활용 | 0원 |
| SSL 인증서 | Let's Encrypt (자동 갱신) | 0원 |
| 자동화 엔진 | n8n (self-hosted Docker) | 0원 |
| DB | PostgreSQL (Docker) | 0원 |
| 봇 | Telegram Bot API | 0원 |
| 캘린더 | Google Calendar API | 0원 |
| 업무 관리 | Notion API (Internal Integration) | 0원 |
| **월 합계** | | **0원** |

---

## 3. 노션 DB 구조 (기존 템플릿 활용)

### 3.1 사용할 DB (4개)
```
업무 카테고리 ──→ 프로젝트 (PARA) ──→ 할 일 (상태/날짜) ──→ 캘린더 (일별 허브)
```

### 3.2 할 일 DB 스키마
| 속성 | 타입 | 설명 |
|---|---|---|
| 할 일 | title | 태스크 제목 |
| 상태 | status | 시작 전 / 진행 중 / 거의 완료 / 완료 / 핀 / 못함 / 취소 등 |
| 시간 | date | 작업 일시 |
| 목표날짜 | date | 마감일 |
| 프로젝트 | relation | → 프로젝트 DB |
| 캘린더 | relation | → 캘린더 DB |
| 메모 | text | 상세 내용 |
| 밀린 업무 | formula | 자동 계산 |

### 3.3 프로젝트 DB 스키마
| 속성 | 타입 | 설명 |
|---|---|---|
| 프로젝트 | title | 프로젝트명 |
| PARA | select | P\|현재 진행, A\|상시 진행, R\|관심분야, A\|보관함 |
| 업무 카테고리 | relation | → 업무 카테고리 DB |
| 할 일 DB | relation | → 할 일 DB |
| 진행률(수식) | formula | 자동 계산 |

### 3.4 캘린더 DB 스키마
| 속성 | 타입 | 설명 |
|---|---|---|
| 캘린더 | title | 날짜 제목 (예: "2/18 화") |
| 날짜 | date | 해당 날짜 |
| 할 일 DB | relation | → 할 일 DB |
| 다이어리 | text | 일일 기록 |

### 3.5 업무 카테고리 DB 스키마
| 속성 | 타입 | 설명 |
|---|---|---|
| 업무 카테고리 | title | 카테고리명 |
| 프로젝트 | relation | → 프로젝트 DB |

### 3.6 Notion API ID 정리
| DB | data-source ID |
|---|---|
| 업무 카테고리 | `30bd119f-a669-8138-8e1f-f78839bf277c` |
| 프로젝트 | `30bd119f-a669-81e2-a747-f9002c0a9910` |
| 할 일 | `30bd119f-a669-81d0-8730-d824b7bc948c` |
| 캘린더 | `30bd119f-a669-812c-8bf4-fe603e6a8c6b` |

---

## 4. 기능 명세

### 4.1 [F1] 텔레그램 봇 → 노션 할 일 등록
**우선순위**: P0 (최우선)

#### 입력 형식
```
프로젝트명 - 할 일 내용 @날짜키워드
```

#### 날짜 키워드 파싱 규칙
| 키워드 | 변환 |
|---|---|
| @오늘, (생략) | 오늘 날짜 |
| @내일 | +1일 |
| @모레 | +2일 |
| @월, @화 ... @일 | 다음 해당 요일 |
| @다음주 | +7일 |
| @2/25, @3/1 | 해당 날짜 (올해) |

#### 프로젝트 매칭 규칙
1. 입력 텍스트에서 ` - ` (공백+하이픈+공백) 기준으로 분리
2. 앞부분을 프로젝트 DB에서 **부분 일치** 검색
3. 매칭 실패 시 → 프로젝트 없이 등록 + "프로젝트 미지정" 안내 회신

#### 처리 흐름
```
1. Telegram Trigger (Polling) → 메시지 수신
2. Code 노드 → 텍스트 파싱 (프로젝트명, 할 일, 날짜)
3. Notion API → 프로젝트 DB 조회 (프로젝트명 매칭)
4. Notion API → 캘린더 DB 조회 (해당 날짜 페이지 존재 여부)
5. [조건] 캘린더 페이지 없으면 → Notion API → 캘린더 페이지 생성
6. Notion API → 할 일 생성 (프로젝트, 캘린더 릴레이션 연결)
7. Telegram → 확인 메시지 회신
```

#### 회신 메시지 형식
```
✅ 할 일 등록 완료
━━━━━━━━━━━━━━━
📋 상세페이지 디자인 검토
📁 자사몰 리뉴얼
📅 2/19(수)
🔗 [노션에서 보기](링크)
```

#### 추가 커맨드
| 커맨드 | 기능 |
|---|---|
| `/목록` 또는 `/list` | 오늘 할 일 목록 조회 |
| `/완료 {번호}` | 할 일 상태를 "완료"로 변경 |
| `/밀린` | 밀린 업무 목록 조회 |

---

### 4.2 [F2] 구글 캘린더 → 노션 동기화
**우선순위**: P1

#### 동기화 방향
- **구글 → 노션**: 구글 캘린더에 일정 추가 시 노션 할 일로 자동 등록
- **역방향은 Phase 2에서 검토**

#### 입력 규칙 (구글 캘린더 제목)
```
프로젝트명 - 할 일 내용
```
텔레그램과 동일한 파싱 규칙 적용. 날짜/시간은 구글 캘린더 일정 시간 사용.

#### 처리 흐름
```
1. Google Calendar Trigger (Polling, 1분 간격)
2. Code 노드 → 제목 파싱
3. Notion API → 프로젝트 매칭 + 캘린더 연결 + 할 일 생성
```

#### 필터링
- `[개인]` 접두사가 붙은 일정은 무시
- 종일 일정은 시간 없이 날짜만 등록
- 반복 일정은 각 인스턴스별로 한 번만 등록 (중복 방지)

---

### 4.3 [F3] 모닝 브리핑
**우선순위**: P1

#### 트리거
- 매일 오전 08:00 (Asia/Seoul)

#### 내용
```
☀️ 2/18(화) 모닝 브리핑
━━━━━━━━━━━━━━━━━━

📁 자사몰 리뉴얼
  · 상세페이지 디자인 검토 [14:00]
  · 메인 배너 수정

📁 견적서 자동화
  · 3월분 견적서 발송

━━━━━━━━━━━━━━━━━━
📊 총 3건 | 진행 중 1 | 시작 전 2

⚠️ 밀린 업무 1건
  · 세금계산서 2월분 발행 (2일 경과)
```

#### 처리 흐름
```
1. Schedule Trigger (08:00)
2. Notion API → 오늘 날짜 할 일 조회 (상태 ≠ 완료/취소)
3. Notion API → 프로젝트별 그룹핑
4. Notion API → 밀린 업무 조회 (목표날짜 < 오늘 AND 상태 ≠ 완료/취소)
5. Code 노드 → 브리핑 메시지 포맷팅
6. Telegram → 발송
```

---

### 4.4 [F4] 밀린 업무 알림
**우선순위**: P2

#### 트리거
- 매일 오전 10:00 (업무 시작 후 리마인드)

#### 조건
- 목표날짜가 지났고 상태가 완료/취소가 아닌 할 일만 대상

#### 메시지 형식
```
⚠️ 밀린 업무 알림
━━━━━━━━━━━━━━━━━━

🔴 3일+ 경과
  · 세금계산서 2월분 발행 (5일)

🟡 1~2일 경과
  · 견적서 수정 (1일)

💡 /완료 명령으로 처리하거나 노션에서 상태를 변경하세요
```

---

## 5. 구현 Phase

### Phase 1: 인프라 구축 (서버 + n8n)
| 단계 | 작업 | 상세 |
|---|---|---|
| 1-1 | Oracle Cloud 계정 생성 | https://signup.oraclecloud.com/ |
| 1-2 | ARM 인스턴스 생성 | VM.Standard.A1.Flex, 2 OCPU / 12GB RAM, Ubuntu 22.04 |
| 1-3 | 서버 기본 설정 | SSH, 방화벽(iptables + OCI Security List), swap |
| 1-4 | Docker + Docker Compose 설치 | Docker CE + Compose v2 플러그인 |
| 1-5 | n8n + PostgreSQL 실행 | docker-compose.yml 배포 |
| 1-6 | 도메인 DNS 설정 | A 레코드 → Oracle Cloud 공인 IP |
| 1-7 | Nginx + Let's Encrypt | 리버스 프록시 + HTTPS 자동 인증서 |
| 1-8 | n8n 접속 확인 | https://n8n.내도메인.com 로그인 |

### Phase 2: 텔레그램 봇 + 노션 연동
| 단계 | 작업 | 상세 |
|---|---|---|
| 2-1 | 텔레그램 봇 생성 | BotFather → 토큰 발급 |
| 2-2 | Notion Integration 생성 | Internal Integration → API 토큰 |
| 2-3 | Notion DB에 Integration 연결 | 4개 DB 모두 공유 설정 |
| 2-4 | n8n 워크플로우 구현 [F1] | 텔레그램 → 파싱 → 노션 등록 |
| 2-5 | 커맨드 구현 | /목록, /완료, /밀린 |
| 2-6 | 테스트 | 모바일/PC에서 입력 테스트 |

### Phase 3: 구글 캘린더 + 자동 알림
| 단계 | 작업 | 상세 |
|---|---|---|
| 3-1 | Google OAuth 설정 | Cloud Console → Calendar API 활성화 |
| 3-2 | n8n Google Calendar credential | OAuth 연결 |
| 3-3 | 워크플로우 구현 [F2] | 구글 캘린더 → 노션 동기화 |
| 3-4 | 워크플로우 구현 [F3] | 모닝 브리핑 |
| 3-5 | 워크플로우 구현 [F4] | 밀린 업무 알림 |
| 3-6 | 전체 통합 테스트 | 모든 워크플로우 동시 작동 확인 |

---

## 6. 서버 설정 상세

### 6.1 Oracle Cloud 인스턴스 스펙
```
Shape:    VM.Standard.A1.Flex
OCPU:     2 (무료 한도 4 중 2 사용, 나머지 여유)
RAM:      12GB (무료 한도 24 중 12 사용)
Boot:     50GB
OS:       Ubuntu 22.04 (aarch64/ARM64)
```

### 6.2 Docker Compose 설정
→ `server-config/docker-compose.yml` 참조

### 6.3 Nginx 설정
→ `server-config/nginx-n8n.conf` 참조

### 6.4 필요한 환경 변수
→ `server-config/.env.example` 참조

---

## 7. 보안 고려사항

| 항목 | 대응 |
|---|---|
| n8n 접근 제어 | 계정 비밀번호 + HTTPS |
| Notion API 토큰 | n8n credential 암호화 저장 (N8N_ENCRYPTION_KEY) |
| Telegram Bot 토큰 | n8n credential 암호화 저장 |
| DB 비밀번호 | .env 파일 (서버 내부, 외부 노출 없음) |
| SSH | 키 기반 인증 (비밀번호 로그인 비활성화) |
| 방화벽 | 22(SSH), 80(HTTP→HTTPS 리다이렉트), 443(HTTPS)만 개방 |

---

## 8. 유지보수

### 자동 관리 항목
- Let's Encrypt SSL: 90일마다 자동 갱신 (certbot timer)
- n8n + PostgreSQL: Docker restart always (자동 재시작)
- Oracle Cloud: Always Free이므로 별도 관리 불필요

### 수동 관리 항목 (월 1회)
- n8n 버전 업데이트: `docker compose pull && docker compose up -d`
- 디스크 사용량 확인: `df -h`
- Docker 로그 정리: `docker system prune -f`

---

## 9. 성공 지표

| 지표 | 목표 |
|---|---|
| 할 일 입력 소요 시간 | 3초 이내 (텔레그램 메시지 전송) |
| 자동 정리 정확도 | 프로젝트 매칭 90% 이상 |
| 시스템 가동률 | 99% (Oracle Cloud SLA) |
| 월 운영 비용 | 0원 |
| 모닝 브리핑 수신 | 매일 08:00 정시 발송 |
