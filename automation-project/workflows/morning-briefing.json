{
  "name": "[F3] ëª¨ë‹ ë¸Œë¦¬í•‘ (08:00)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            { "triggerAtHour": 8, "triggerAtMinute": 0 }
          ]
        }
      },
      "id": "node-schedule",
      "name": "ë§¤ì¼ 08:00",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.notion.com/v1/databases/30bd119f-a669-81d0-8730-d824b7bc948c/query",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Notion-Version", "value": "2022-06-28" }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ (() => { const now = new Date(); const y = now.getFullYear(); const m = String(now.getMonth()+1).padStart(2,'0'); const d = String(now.getDate()).padStart(2,'0'); const today = y+'-'+m+'-'+d; return JSON.stringify({ filter: { and: [{ property: 'ì‹œê°„', date: { equals: today } }, { property: 'ìƒíƒœ', status: { does_not_equal: 'ì™„ë£Œ' } }, { property: 'ìƒíƒœ', status: { does_not_equal: 'ì·¨ì†Œ' } }] }, sorts: [{ property: 'ì‹œê°„', direction: 'ascending' }], page_size: 100 }); })() }}"
      },
      "id": "node-today-todos",
      "name": "ì˜¤ëŠ˜ í•  ì¼ ì¡°íšŒ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [220, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "NOTION_HEADER_AUTH_ID",
          "name": "Notion API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.notion.com/v1/databases/30bd119f-a669-81d0-8730-d824b7bc948c/query",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Notion-Version", "value": "2022-06-28" }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ (() => { const now = new Date(); const y = now.getFullYear(); const m = String(now.getMonth()+1).padStart(2,'0'); const d = String(now.getDate()).padStart(2,'0'); const today = y+'-'+m+'-'+d; return JSON.stringify({ filter: { and: [{ property: 'ëª©í‘œë‚ ì§œ', date: { before: today } }, { property: 'ìƒíƒœ', status: { does_not_equal: 'ì™„ë£Œ' } }, { property: 'ìƒíƒœ', status: { does_not_equal: 'ì·¨ì†Œ' } }] }, sorts: [{ property: 'ëª©í‘œë‚ ì§œ', direction: 'ascending' }], page_size: 100 }); })() }}"
      },
      "id": "node-overdue",
      "name": "ë°€ë¦° ì—…ë¬´ ì¡°íšŒ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [220, 500],
      "credentials": {
        "httpHeaderAuth": {
          "id": "NOTION_HEADER_AUTH_ID",
          "name": "Notion API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ëª¨ë‹ ë¸Œë¦¬í•‘ ë©”ì‹œì§€ ìƒì„±\nconst todayResults = $('ì˜¤ëŠ˜ í•  ì¼ ì¡°íšŒ').first().json.results || [];\nconst overdueResults = $('ë°€ë¦° ì—…ë¬´ ì¡°íšŒ').first().json.results || [];\n\nconst days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];\nconst now = new Date();\nconst dateLabel = `${now.getMonth()+1}/${now.getDate()}(${days[now.getDay()]})`;\n\n// í”„ë¡œì íŠ¸ë³„ ê·¸ë£¹í•‘\nconst groups = {};\nlet inProgress = 0;\nlet notStarted = 0;\n\ntodayResults.forEach(item => {\n  const title = item.properties['í•  ì¼']?.title?.[0]?.plain_text || '(ì œëª© ì—†ìŒ)';\n  const status = item.properties['ìƒíƒœ']?.status?.name || 'ì‹œì‘ ì „';\n  const projRel = item.properties['í”„ë¡œì íŠ¸']?.relation || [];\n  const projName = projRel.length > 0 ? 'í”„ë¡œì íŠ¸' : 'ê¸°íƒ€';\n  // ì‹œê°„ ì¶”ì¶œ\n  const timeStr = item.properties['ì‹œê°„']?.date?.start || '';\n  let timeLabel = '';\n  if (timeStr && timeStr.includes('T')) {\n    const t = timeStr.split('T')[1];\n    timeLabel = ` [${t.substring(0,5)}]`;\n  }\n\n  if (!groups[projName]) groups[projName] = [];\n  groups[projName].push({ title, status, timeLabel });\n\n  if (status === 'ì§„í–‰ ì¤‘') inProgress++;\n  else notStarted++;\n});\n\n// ë©”ì‹œì§€ ì¡°ë¦½\nlet msg = `â˜€ï¸ ${dateLabel} ëª¨ë‹ ë¸Œë¦¬í•‘\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\n\nif (todayResults.length === 0) {\n  msg += '\\nì˜¤ëŠ˜ ë“±ë¡ëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.';\n} else {\n  for (const [proj, items] of Object.entries(groups)) {\n    msg += `\\nğŸ“ ${proj}`;\n    items.forEach(item => {\n      msg += `\\n  Â· ${item.title}${item.timeLabel}`;\n    });\n  }\n  msg += `\\n\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;\n  msg += `\\nğŸ“Š ì´ ${todayResults.length}ê±´`;\n  if (inProgress > 0) msg += ` | ì§„í–‰ ì¤‘ ${inProgress}`;\n  if (notStarted > 0) msg += ` | ì‹œì‘ ì „ ${notStarted}`;\n}\n\n// ë°€ë¦° ì—…ë¬´\nif (overdueResults.length > 0) {\n  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  msg += `\\n\\nâš ï¸ ë°€ë¦° ì—…ë¬´ ${overdueResults.length}ê±´`;\n  overdueResults.slice(0, 5).forEach(item => {\n    const title = item.properties['í•  ì¼']?.title?.[0]?.plain_text || '(ì œëª© ì—†ìŒ)';\n    const dueStr = item.properties['ëª©í‘œë‚ ì§œ']?.date?.start;\n    if (dueStr) {\n      const due = new Date(dueStr);\n      const diff = Math.floor((today - due) / (1000*60*60*24));\n      msg += `\\n  Â· ${title} (${diff}ì¼ ê²½ê³¼)`;\n    }\n  });\n  if (overdueResults.length > 5) msg += `\\n  ... ì™¸ ${overdueResults.length - 5}ê±´`;\n}\n\nreturn [{ json: { text: msg } }];"
      },
      "id": "node-format-briefing",
      "name": "ë¸Œë¦¬í•‘ í¬ë§·",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 400]
    },
    {
      "parameters": {
        "chatId": "7713811206",
        "text": "={{ $json.text }}",
        "additionalFields": {}
      },
      "id": "node-send-briefing",
      "name": "í…”ë ˆê·¸ë¨ ë°œì†¡",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [720, 400],
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram Bot"
        }
      }
    }
  ],
  "connections": {
    "ë§¤ì¼ 08:00": {
      "main": [
        [
          { "node": "ì˜¤ëŠ˜ í•  ì¼ ì¡°íšŒ", "type": "main", "index": 0 },
          { "node": "ë°€ë¦° ì—…ë¬´ ì¡°íšŒ", "type": "main", "index": 0 }
        ]
      ]
    },
    "ì˜¤ëŠ˜ í•  ì¼ ì¡°íšŒ": { "main": [[{ "node": "ë¸Œë¦¬í•‘ í¬ë§·", "type": "main", "index": 0 }]] },
    "ë°€ë¦° ì—…ë¬´ ì¡°íšŒ": { "main": [[{ "node": "ë¸Œë¦¬í•‘ í¬ë§·", "type": "main", "index": 0 }]] },
    "ë¸Œë¦¬í•‘ í¬ë§·": { "main": [[{ "node": "í…”ë ˆê·¸ë¨ ë°œì†¡", "type": "main", "index": 0 }]] }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Seoul"
  },
  "tags": [{ "name": "ì—…ë¬´ìë™í™”" }]
}
