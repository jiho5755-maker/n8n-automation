{
  "name": "[F4] ë°€ë¦° ì—…ë¬´ ì•Œë¦¼ (10:00)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            { "triggerAtHour": 10, "triggerAtMinute": 0 }
          ]
        }
      },
      "id": "node-schedule",
      "name": "ë§¤ì¼ 10:00",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.notion.com/v1/databases/30bd119f-a669-81d0-8730-d824b7bc948c/query",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Notion-Version", "value": "2022-06-28" }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ (() => { const now = new Date(); const y = now.getFullYear(); const m = String(now.getMonth()+1).padStart(2,'0'); const d = String(now.getDate()).padStart(2,'0'); const today = y+'-'+m+'-'+d; return JSON.stringify({ filter: { and: [{ property: 'ëª©í‘œë‚ ì§œ', date: { before: today } }, { property: 'ìƒíƒœ', status: { does_not_equal: 'ì™„ë£Œ' } }, { property: 'ìƒíƒœ', status: { does_not_equal: 'ì·¨ì†Œ' } }] }, sorts: [{ property: 'ëª©í‘œë‚ ì§œ', direction: 'ascending' }], page_size: 100 }); })() }}"
      },
      "id": "node-query-overdue",
      "name": "ë°€ë¦° ì—…ë¬´ ì¡°íšŒ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [220, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "NOTION_HEADER_AUTH_ID",
          "name": "Notion API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ë°€ë¦° ì—…ë¬´ ì—†ìœ¼ë©´ ë°œì†¡ ì•ˆ í•¨\nconst results = $input.first().json.results || [];\nif (results.length === 0) {\n  // ë¹ˆ ë°°ì—´ ë°˜í™˜ â†’ ë‹¤ìŒ ë…¸ë“œ ì‹¤í–‰ ì•ˆ ë¨\n  return [];\n}\n\nconst now = new Date();\nconst today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n\nconst severe = []; // 3ì¼+\nconst mild = [];   // 1~2ì¼\n\nresults.forEach(item => {\n  const title = item.properties['í•  ì¼']?.title?.[0]?.plain_text || '(ì œëª© ì—†ìŒ)';\n  const dueStr = item.properties['ëª©í‘œë‚ ì§œ']?.date?.start;\n  if (!dueStr) return;\n  const due = new Date(dueStr);\n  const diffDays = Math.floor((today - due) / (1000*60*60*24));\n  const entry = { title, diffDays };\n  if (diffDays >= 3) severe.push(entry);\n  else mild.push(entry);\n});\n\nlet msg = 'âš ï¸ ë°€ë¦° ì—…ë¬´ ì•Œë¦¼\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n\nif (severe.length > 0) {\n  msg += '\\nğŸ”´ 3ì¼+ ê²½ê³¼';\n  severe.forEach(e => { msg += `\\n  Â· ${e.title} (${e.diffDays}ì¼)`; });\n}\nif (mild.length > 0) {\n  msg += '\\n\\nğŸŸ¡ 1~2ì¼ ê²½ê³¼';\n  mild.forEach(e => { msg += `\\n  Â· ${e.title} (${e.diffDays}ì¼)`; });\n}\n\nmsg += `\\n\\nğŸ“Š ì´ ${results.length}ê±´`;\nmsg += '\\n\\nğŸ’¡ /ì™„ë£Œ ëª…ë ¹ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ ë…¸ì…˜ì—ì„œ ìƒíƒœë¥¼ ë³€ê²½í•˜ì„¸ìš”';\n\nreturn [{ json: { text: msg } }];"
      },
      "id": "node-format",
      "name": "ì•Œë¦¼ í¬ë§·",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [440, 300]
    },
    {
      "parameters": {
        "chatId": "7713811206",
        "text": "={{ $json.text }}",
        "additionalFields": {}
      },
      "id": "node-send",
      "name": "í…”ë ˆê·¸ë¨ ë°œì†¡",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [660, 300],
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram Bot"
        }
      }
    }
  ],
  "connections": {
    "ë§¤ì¼ 10:00": { "main": [[{ "node": "ë°€ë¦° ì—…ë¬´ ì¡°íšŒ", "type": "main", "index": 0 }]] },
    "ë°€ë¦° ì—…ë¬´ ì¡°íšŒ": { "main": [[{ "node": "ì•Œë¦¼ í¬ë§·", "type": "main", "index": 0 }]] },
    "ì•Œë¦¼ í¬ë§·": { "main": [[{ "node": "í…”ë ˆê·¸ë¨ ë°œì†¡", "type": "main", "index": 0 }]] }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Seoul"
  },
  "tags": [{ "name": "ì—…ë¬´ìë™í™”" }]
}
