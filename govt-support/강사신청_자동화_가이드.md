# 에어테이블 강사 신청 자동화 완전 가이드
> 에어테이블 폼 → n8n → 텔레그램 알림 + 메이크샵 등급 자동 변경
> **완전 초보자도 따라할 수 있는 단계별 설명**

---

## 이 시스템이 하는 일

```
고객이 에어테이블 폼 작성
        ↓ (5분 이내)
텔레그램으로 알림 수신 📱
        ↓ (에어테이블에서 수동 승인 체크)
메이크샵 회원 등급 자동 변경 🏷️
        ↓
처리 결과 텔레그램 알림
```

| 워크플로우 | 역할 |
|----------|------|
| **FA-002** | 신규 신청 감지 → 텔레그램 알림 (5분마다) |
| **FA-001** | 에어테이블 승인 체크 → 메이크샵 등급 변경 (5분마다) |

---

## 사전 준비 — 필요한 계정/도구

시작 전에 아래 4가지가 준비되어야 합니다.

| 항목 | 용도 | 비용 | 가입 주소 |
|------|------|------|---------|
| **에어테이블** | 신청 폼 + 데이터 저장 | 무료 | airtable.com |
| **텔레그램** | 알림 수신 | 무료 | telegram.org |
| **n8n** | 자동화 엔진 (이미 설치됨) | 서버비용 | n8n.pressco21.com |
| **메이크샵 오픈 API** | 회원 등급 변경 | 무료 | 관리자 > 오픈 API |

---

## STEP 1 — 에어테이블 설정

### 1-1. 에어테이블 Base 생성

1. [airtable.com](https://airtable.com) 접속 후 로그인
2. 왼쪽 상단 **+ Create** 클릭
3. **Start from scratch** 선택 → Base 이름 입력 (예: `강사관리`)
4. 생성 완료 후 Base ID 메모 (URL에서 확인: `https://airtable.com/appXXXXXXXX/...` → `appXXXXXXXX` 부분)

### 1-2. 테이블 필드 구성

테이블에 아래 필드들을 추가합니다.

> 📌 기본 생성된 "Name" 필드는 **"성함"** 으로 이름 변경하세요.

| 필드명 | 타입 | 설명 |
|-------|------|------|
| 성함 | Single line text | 기본 필드명 변경 |
| 연락처 | Phone number | - |
| 이메일 주소 | Email | - |
| 자사몰 ID | Single line text | 메이크샵 아이디 |
| 신청 일시 | Date | 날짜+시간 포함 체크 |
| 신청 경과일 | Number | - |
| n8n_강사승인 | Checkbox | ✅ 승인 시 체크 (FA-001 트리거) |
| n8n_신청알림 | Checkbox | ✅ 알림 발송 완료 표시 (FA-002 자동 처리) |
| 처리일시 | Date | FA-001이 자동 기록 |

**필드 추가 방법:**
1. 테이블 오른쪽 끝 **+** 버튼 클릭
2. 필드 타입 선택 → 이름 입력 → Save

### 1-3. 폼 뷰 생성 (고객이 작성할 신청 폼)

1. 테이블 상단 **+** (Add a view) 클릭 → **Form** 선택
2. 폼 이름 입력 (예: `강사 신청 폼`)
3. 폼에 표시할 필드 체크:
   - ✅ 성함
   - ✅ 연락처
   - ✅ 이메일 주소
   - ✅ 자사몰 ID
   - ❌ n8n_강사승인, n8n_신청알림, 처리일시 (숨김)
4. **Share form** 버튼 → 링크 복사 (고객에게 이 링크를 전달)

### 1-4. `n8n_신청알림` 필드 초기값 설정

> 기존 레코드가 있다면, 이미 신청한 사람들에게 알림이 다시 가지 않도록 기존 데이터를 모두 체크 처리해야 합니다.

1. `n8n_신청알림` 컬럼 헤더 클릭 → **Select all records**
2. 전체 선택 후 `n8n_신청알림`을 모두 `true`(체크)로 설정

---

## STEP 2 — 에어테이블 API 키 발급

n8n이 에어테이블에 접근하려면 API 키(Personal Access Token)가 필요합니다.

1. [airtable.com/account](https://airtable.com/account) 접속
2. **Developer hub** → **Personal access tokens** → **Create new token**
3. 이름 입력 (예: `n8n-access`)
4. Scopes 선택:
   - ✅ `data.records:read`
   - ✅ `data.records:write`
   - ✅ `schema.bases:read`
5. Access → **Add a base** → 방금 만든 Base 선택
6. **Create token** → 토큰 복사 (`patXXXXXXXXXX...` 형태)

> ⚠️ 이 토큰은 한 번만 표시됩니다. 반드시 메모장에 복사해두세요!

---

## STEP 3 — 텔레그램 봇 생성

알림을 받을 전용 봇을 만듭니다.

### 3-1. 봇 생성

1. 텔레그램에서 **@BotFather** 검색 → 채팅 시작
2. `/newbot` 입력
3. 봇 이름 입력 (예: `내쇼핑몰봇`)
4. 봇 username 입력 (예: `myshop_notification_bot`) — 끝에 반드시 `bot` 붙여야 함
5. 생성 완료 → **API 토큰 복사** (`1234567890:AAXXXXXXXX...` 형태)

### 3-2. 내 Chat ID 확인

1. 방금 만든 봇에게 아무 메시지나 보내기 (예: `안녕`)
2. 브라우저에서 아래 URL 접속:
   ```
   https://api.telegram.org/bot[토큰]/getUpdates
   ```
   (예: `https://api.telegram.org/bot1234567890:AAXX.../getUpdates`)
3. 응답에서 `"id"` 값 찾기 → 이것이 **Chat ID**

```json
{
  "result": [{
    "message": {
      "chat": {
        "id": 7713811206,  ← 이 숫자가 Chat ID
        ...
```

---

## STEP 4 — n8n에 자격증명 등록

n8n이 에어테이블과 텔레그램에 접근할 수 있도록 API 키를 등록합니다.

### 4-1. n8n 접속

브라우저에서 `https://n8n.pressco21.com` 접속 → 로그인

### 4-2. 텔레그램 자격증명 등록

1. 왼쪽 메뉴 **Credentials** 클릭
2. **Add Credential** → `Telegram` 검색 → 선택
3. 이름: `내 텔레그램봇` (원하는 이름)
4. Access Token: 3-1에서 복사한 봇 토큰 입력
5. **Save** 클릭

### 4-3. 에어테이블 자격증명 등록

1. **Add Credential** → `Airtable` 검색 → **Airtable Personal Access Token** 선택
2. 이름: `Airtable PAT`
3. Access Token: STEP 2에서 복사한 토큰 입력
4. **Save** 클릭

---

## STEP 5 — FA-002 워크플로우 설정 (신청 알림)

### 5-1. 워크플로우 가져오기

1. n8n 좌측 메뉴 **Workflows** 클릭
2. 오른쪽 상단 **↑ Import** 또는 **+** 메뉴에서 **Import from file** 선택
3. `FA-002_강사_신청_알림.json` 파일 선택

### 5-2. 각 노드 확인 및 수정

**① 5분 스케줄 노드**
- 변경 불필요 (5분마다 자동 실행)

**② 신규 신청 조회 노드 (Airtable)**

더블클릭 후 확인:
- Credential: `Airtable PAT` 선택
- Base ID: `app여러분의BaseID` 입력 (STEP 1-1에서 메모한 값)
- Table: 테이블 선택

> 🔍 **Base ID 찾는 방법**: 에어테이블에서 해당 Base 열기 → URL 확인
> `https://airtable.com/appXXXXXXXX/tblYYYYYY` → `appXXXXXXXX` 부분

**③ 텔레그램 신청 알림 노드**
- Credential: `내 텔레그램봇` 선택
- Chat ID: STEP 3-2에서 확인한 Chat ID 입력

**④ 신청알림 발송 표시 노드 (HTTP Request)**

URL 확인:
```
https://api.airtable.com/v0/[Base ID]/[Table ID]
```
- Headers → Authorization 값: `Bearer [에어테이블 PAT 토큰]`

### 5-3. 워크플로우 활성화

오른쪽 상단 **Inactive** 토글 → **Active** 로 변경 ✅

---

## STEP 6 — FA-001 워크플로우 설정 (등급 자동 변경)

### 6-1. 메이크샵 오픈 API 키 확인

1. 메이크샵 관리자 로그인
2. **운영관리** → **오픈 API** → **API 키 확인**
3. 허용 IP에 n8n 서버 IP (`158.180.77.201`) 추가

### 6-2. 워크플로우 가져오기

`FA-001_강사회원_등급_자동변경.json` 파일 import

### 6-3. 각 노드 수정

**① 신규 신청 조회 노드**
- FA-002와 동일하게 Credential, Base ID 설정
- Filter 설정 확인: `{n8n_강사승인} = 1` (체크된 레코드만 처리)

**② 등급 변경 HTTP Request 노드**
```
URL: https://openapi.makeshop.co.kr/v3/member/grade/update
Method: POST
Header:
  - Content-Type: application/json
  - Authorization: Bearer [메이크샵 API 키]
```

**③ 텔레그램 알림 노드**
- Credential, Chat ID 동일하게 설정

### 6-4. 워크플로우 활성화

**Active** 토글 ON ✅

---

## STEP 7 — 동작 테스트

### 7-1. FA-002 테스트 (알림 확인)

1. 에어테이블에서 테스트 레코드 1건 추가:
   - 성함: `홍길동테스트`
   - 연락처: `01012345678`
   - n8n_신청알림: **체크 해제** (비워둔 상태)
2. 최대 **5분** 대기
3. 텔레그램에 아래와 같은 알림 수신 확인:
   ```
   🆕 강사 신청 1건 접수

   1. 홍길동테스트 | 01012345678 | - | -

   에어테이블에서 승인 처리해주세요.
   ```
4. 에어테이블에서 해당 레코드의 `n8n_신청알림` 체크 확인

### 7-2. FA-001 테스트 (등급 변경 확인)

1. 에어테이블에서 테스트 레코드의 **n8n_강사승인** 체크 ✅
2. 최대 **5분** 대기
3. 텔레그램에 등급 변경 성공 알림 수신 확인
4. 메이크샵 관리자 → 해당 회원 등급이 변경됐는지 확인

### 7-3. 테스트 레코드 삭제

테스트 완료 후 에어테이블에서 테스트 레코드 삭제

---

## STEP 8 — 실제 운영 방법

### 일반 운영 흐름

```
① 고객이 폼 링크로 신청 제출
         ↓ (자동, 5분 이내)
② 텔레그램으로 알림 수신
         ↓ (운영자 직접 수행)
③ 에어테이블에서 신청 내용 확인
         ↓
④ 승인 → n8n_강사승인 체크 ✅
   거부 → 레코드 삭제 또는 메모 작성
         ↓ (자동, 5분 이내)
⑤ 메이크샵 회원 등급 자동 변경
⑥ 완료 텔레그램 알림 수신
```

### 에어테이블에서 처리 방법

| 상황 | 처리 방법 |
|------|---------|
| 신청 승인 | `n8n_강사승인` 체크 ✅ |
| 신청 거부 | 체크 없이 메모만 남김 (또는 레코드 삭제) |
| 재처리 필요 | `n8n_강사승인` 체크 해제 후 다시 체크 |

---

## 자주 묻는 질문 (FAQ)

**Q. 알림이 5분 이상 지연됩니다.**
A. n8n 서버가 재시작됐거나 스케줄이 잠시 지연될 수 있습니다. 최대 10분까지 기다려보세요. 10분 이상이면 n8n Executions 탭에서 오류를 확인하세요.

**Q. 텔레그램 알림은 왔는데 에어테이블에서 체크가 안 됩니다.**
A. n8n Executions 탭 → 해당 실행 클릭 → 마지막 노드 오류 확인. 에어테이블 API 토큰이 만료됐을 수 있습니다. STEP 2로 돌아가서 새 토큰 발급 후 자격증명 업데이트.

**Q. 등급 변경이 안 됩니다.**
A. 아래 순서로 확인:
1. 메이크샵 관리자 → 오픈 API → 허용 IP에 `158.180.77.201` 있는지 확인
2. n8n Executions에서 FA-001 오류 확인
3. 해당 회원이 메이크샵에 실제로 가입돼 있는지 확인

**Q. 여러 건이 쌓였을 때 한꺼번에 알림이 옵니까?**
A. 네, FA-002는 한 번 실행 시 `n8n_신청알림`이 체크되지 않은 모든 레코드를 한 번에 모아서 알림을 보냅니다.

**Q. 운영 중 n8n 서버가 꺼지면?**
A. 서버가 재시작되면 워크플로우가 자동으로 다시 활성화됩니다. `docker compose restart` 명령어로 재시작하면 됩니다.

---

## 문제 해결 — n8n Executions 확인 방법

1. n8n 접속 → 좌측 메뉴 **Executions** 클릭
2. 워크플로우 이름으로 필터
3. 빨간색 `error` 항목 클릭
4. 오류가 발생한 노드 (빨간 테두리) 클릭
5. 오류 메시지 확인

### 주요 오류 메시지 해석

| 오류 메시지 | 원인 | 해결 방법 |
|-----------|------|---------|
| `401 Unauthorized` | API 키 잘못됨 또는 만료 | API 키 재발급 후 자격증명 업데이트 |
| `403 Forbidden` | 권한 없음 | 허용 IP 확인 또는 권한 범위 확인 |
| `422 Invalid Records` | 에어테이블 레코드 형식 오류 | 필드명 확인, 타입 확인 |
| `Connection refused` | n8n 서버 문제 | `docker compose restart` |

---

## 구성 정보 (실제 운영 환경)

| 항목 | 값 |
|------|-----|
| n8n 서버 | n8n.pressco21.com |
| 텔레그램 봇 | @Pressco21_makeshop_bot |
| 에어테이블 Base | app6MBsHo7AKwh5XD |
| FA-001 워크플로우 ID | jaTfiQuY35DjgrxN |
| FA-002 워크플로우 ID | ovWkhq7E0ZqvjBIZ |
| 실행 주기 | 5분마다 |

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-24 | FA-001 v1.0 완성 — 강사회원 180건 일괄 등급 변경 완료 |
| 2026-02-24 | @Pressco21_makeshop_bot 전용 봇 분리 |
| 2026-02-25 | FA-002 완성 — 신규 신청 알림 워크플로우 가동 |
