# Pressco21 자동화 리소스 관리 전략

> 최초 작성: 2026-02-26 | 목적: 자동화 확장 시 한도 충돌 방지 + 선제적 관리

---

## 1. 서버 리소스 현황 (Oracle Cloud Free Tier ARM)

| 항목 | 전체 | 현재 사용 | 안전 한도 | 경고 기준 |
|------|------|----------|----------|---------|
| RAM | 12 GB | ~1.5 GB | 10 GB | 8 GB 초과 시 |
| Disk | 45 GB | 6.5 GB (15%) | 35 GB | 30 GB 초과 시 |
| CPU | 2 OCPU | 평시 5~15% | 80% | 70% 지속 시 |

### 서비스별 RAM 점유 (추정)
```
n8n           500 MB
PostgreSQL    400 MB
NocoDB        500 MB
nginx          50 MB
OS/기타       300 MB
─────────────────────
현재 합계   ~1.75 GB (여유: 10.25 GB)
```

### n8n 실행 데이터 자동 정리 (2026-02-26 설정 완료)
```
EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_DATA_MAX_AGE=30        # 30일 이상 삭제
EXECUTIONS_DATA_PRUNE_MAX_COUNT=5000  # 최대 5,000건 보관
```

---

## 2. 메이크샵 오픈 API 관리 전략

**한도**: 시간당 500회 (조회/처리 각각)

### 워크플로우별 API 예산 배분

| 워크플로우 | 주기 | 예상 호출/시간 | 배정 예산 |
|-----------|------|-------------|---------|
| FA-001 강사 등업 | 5분 | 평시 2회, 건당 최대 4회 | 50회 |
| F004 CS 자동화 (예정) | 30분 | 2회/실행 | 50회 |
| 파트너클래스 WF-05 주문폴링 (예정) | 10분 | 2회/실행 | 80회 |
| 파트너클래스 기타 WF (예정) | 다양 | 산발적 | 100회 |
| **비상 예비** | — | — | **220회** |
| **합계** | | | **500회** |

### 스케줄 충돌 방지 규칙 (시간 엇갈리기)

```
:00분 기준 — FA-001 (5분 간격)
:02분 기준 — F004 CS (30분 간격)
:04분 기준 — WF-05 주문폴링 (10분 간격)
:06분 기준 — 기타 파트너클래스 WF
```
→ 같은 분에 여러 워크플로우가 동시 실행되지 않도록 설계

### 429 에러 대응 패턴 (모든 MakeShop HTTP Request 노드에 적용)

```
onError: continueRegularOutput  ← 에러 시 중단하지 않고 계속
retryOnFail: true
maxTries: 3
waitBetweenTries: 5000ms        ← 5초 대기 후 재시도
```

### 월간 호출 예상량 (현재 운영 워크플로우)

| 워크플로우 | 월 호출 수 |
|-----------|----------|
| FA-001 (5분, 평시 건 없음) | ~100회 (신청 없는 날 1회/실행) |
| FA-001 (신청 처리 시) | 건당 2~4회 추가 |
| **현재 합계** | **~200회/월** |
| 파트너클래스 풀가동 후 예상 | ~8,000~15,000회/월 |

---

## 3. 외부 API 한도 현황

### Notion API
- **한도**: 초당 3회 (월간 제한 없음)
- **현재 사용**: F030a (매일 1회), F030b (매주 1회) → 안전
- **위험 시점**: CS 자동화에서 문의 건별 DB 기록 시
- **대응**: 건당 처리 사이 330ms 대기 삽입

### Telegram Bot API
- **한도**: 같은 채팅ID에 분당 20메시지
- **현재 사용**: 2개 봇, Chat ID 7713811206 공유
- **위험 시점**: 파트너클래스 WF 여러 개 동시 발화 시
- **대응**: 스케줄 분산, 알림 묶어서 1회 발송

### OpenAI API (미래)
- **한도**: 비용 기반 (월 $10 예산 권장)
- **예상 사용**: 리뷰 자동 답변 시 1건당 gpt-4o-mini ~$0.001
- **대응**: 월 사용량 n8n 실행 로그로 추적

### NocoDB (자체 서버)
- **한도**: 없음
- **관리 포인트**: DB 파일 크기 (45GB 디스크 한도 내)

---

## 4. 월간 점검 체크리스트

매월 1일 수동 확인 (5분 소요):

```
[ ] 서버 디스크 사용량 확인
    ssh ubuntu@158.180.77.201 "df -h /"

[ ] n8n 실행 DB 크기 확인
    ssh ubuntu@158.180.77.201 "cd ~/n8n && docker compose exec -T postgres psql -U n8nuser -d n8n -c 'SELECT pg_size_pretty(pg_database_size(current_database()));'"

[ ] 전월 메이크샵 API 호출 패턴 확인
    n8n 관리자 > 실행 로그 > FA-001 실행 횟수

[ ] 에러 발생 워크플로우 확인
    n8n 관리자 > Overview > Failed executions

[ ] 새 워크플로우 추가 시 API 예산 재배분 계획
```

---

## 5. 워크플로우 추가 시 체크리스트

새 워크플로우 배포 전 반드시 확인:

```
[ ] 메이크샵 API 호출 횟수 계산
    (실행 주기/시간) × (호출수/실행) = 시간당 호출
    → 기존 배정량과 합산해 500회 초과 여부 확인

[ ] 스케줄 시작 분 기존 워크플로우와 충돌 없는지 확인

[ ] onError 설정 확인 (continueRegularOutput 권장)

[ ] 데이터 소스: NocoDB 우선 (에어테이블 사용 금지)

[ ] Telegram 알림: 동시 발화 가능성 점검
```

---

## 6. 서비스별 URL 및 접속 정보

| 서비스 | URL | 용도 |
|--------|-----|------|
| n8n | https://n8n.pressco21.com | 워크플로우 자동화 엔진 |
| NocoDB | https://nocodb.pressco21.com | 강사공간 DB + 파트너클래스 DB |
| 서버 SSH | ubuntu@158.180.77.201 | Oracle Cloud ARM |

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-26 | 문서 최초 작성. n8n prune 설정 완료, NocoDB 설치 확인 |
| 2026-02-26 | 에어테이블 → NocoDB 마이그레이션 시작 (강사공간 204건) |
