# 정부지원사업 자동수집 시스템 개발 로드맵

정부 지원사업 공고를 매일 자동 수집하고, Gemini AI로 Pressco21 업종 적합성을 분석하여, 검토 가치 있는 공고만 텔레그램으로 알림하는 n8n 워크플로우 시스템.

## 개요

**정부지원사업 자동수집 시스템**은 Pressco21 경영기획팀장 1인을 위한 **정부 공고 자동 모니터링 시스템**으로 다음 기능을 제공합니다:

- **3개 소스 자동 수집**: 기업마당, K-Startup, 보조금24 API에서 매일 오전 신규 공고 자동 수집
- **AI 적합성 분석**: Gemini 2.0 Flash로 Pressco21(꽃/공예 도소매) 업종 적합성 0~10점 자동 평가
- **점수별 알림 분기**: 7점 이상 긴급 알림, 4~6점 검토 권장, 3점 이하 Airtable 저장만
- **Airtable 통합 관리**: 전체 공고 이력 저장, 처리상태 추적, 담당자 메모 관리
- **텔레그램 알림**: 긴급/검토 공고 개별 알림 + 일일 수집 요약 리포트

## 기술 스택 및 인프라

| 항목 | 기술 |
|------|------|
| 워크플로우 엔진 | n8n self-hosted (Docker, Oracle Cloud ARM) |
| 서버 | 158.180.77.201 (n8n.pressco21.com) |
| AI 분석 | Gemini 2.0 Flash (Google AI Studio 무료 티어) |
| 데이터 저장 | Airtable (Base: `app6CynYU5qzIFyKl`) |
| 알림 채널 | Telegram Bot (@Pressco21_bot, Chat ID: 7713811206) |
| 수집 소스 | 기업마당 API, K-Startup API (공공데이터포털), 보조금24 API (공공데이터포털) |

## 담당 에이전트 목록

| 에이전트 ID | 역할 | 주요 담당 |
|-------------|------|----------|
| `n8n-server-ops` | 서버 운영 | Docker, 환경 변수, 워크플로우 import/activate, 서버 상태 관리 |
| `n8n-workflow-builder` | 워크플로우 개발 | n8n 워크플로우 JSON 생성/수정, 노드 구성, 데이터 변환 로직 |
| `development-planner` | 개발 계획 | 로드맵 업데이트, 진행 상황 추적, 의존성 관리 |

---

## 개발 워크플로우

1. **작업 계획**

   - 기존 코드베이스(n8n 서버, Airtable, 워크플로우 JSON)를 학습하고 현재 상태를 파악
   - 새로운 작업을 포함하도록 `ROADMAP.md` 업데이트
   - 우선순위 작업은 마지막 완료된 작업 다음에 삽입

2. **작업 생성**

   - 기존 코드베이스를 학습하고 현재 상태를 파악
   - `/tasks` 디렉토리에 새 작업 파일 생성
   - 명명 형식: `GS-XXX-description.md` (예: `GS-001-env-setup.md`)
   - 고수준 명세서, 관련 파일, 수락 기준, 구현 단계 포함
   - API 연동 및 비즈니스 로직 작업 시 "## 테스트 체크리스트" 섹션 필수 포함 (Playwright MCP 테스트 시나리오 작성)

3. **작업 구현**

   - 작업 파일의 명세서를 따름
   - 기능과 기능성 구현
   - API 연동 및 비즈니스 로직 구현 시 Playwright MCP로 테스트 수행 필수
   - 각 단계 후 작업 파일 내 단계 진행 상황 업데이트
   - 구현 완료 후 Playwright MCP를 사용한 E2E 테스트 실행
   - 테스트 통과 확인 후 다음 단계로 진행
   - 각 단계 완료 후 중단하고 추가 지시를 기다림

4. **로드맵 업데이트**

   - 로드맵에서 완료된 작업을 완료로 표시
   - Phase 전체 완료 시 Phase 제목에 완료 표시 추가

---

## 개발 단계

### Phase 0: 환경 준비 및 사전 검증

> 목표: n8n 서버 상태 확인, 환경 변수 등록, Airtable 테이블 생성, 각 API 단독 연결 테스트까지 완료하여 Phase 1 워크플로우 조립에 필요한 모든 기반을 확보한다.

---

**GS-001: n8n 서버 상태 확인 및 접속 검증** - 우선순위

- 담당 에이전트: `n8n-server-ops`
- 상태: ✅ 완료 (2026-02-24)
- 예상 소요: 15분
- 선행 태스크: 없음
- 작업 내용:
  - SSH로 Oracle Cloud 서버(158.180.77.201) 접속 확인
  - Docker 컨테이너 상태 확인 (`docker ps` 로 n8n 컨테이너 실행 상태)
  - n8n 웹 UI 접속 확인 (https://n8n.pressco21.com)
  - 디스크 공간 및 메모리 여유 확인 (`df -h`, `free -h`)
  - 기존 워크플로우 목록 확인 (FA-001 등 기존 워크플로우와의 충돌 없는지)
- 완료 기준:
  - [ ] SSH 접속 성공
  - [ ] n8n Docker 컨테이너 정상 실행 확인
  - [ ] n8n 웹 UI 로그인 성공
  - [ ] 서버 리소스 여유 확인 (디스크 80% 미만, 메모리 50% 미만)
  - [ ] 기존 워크플로우와 충돌 위험 없음 확인

---

**GS-002: n8n 환경 변수 7개 등록**

- 담당 에이전트: `n8n-server-ops`
- 상태: ✅ 완료 (2026-02-25, 대안 방식)
- 예상 소요: 20분
- 선행 태스크: GS-001
- 작업 내용:
  - n8n 관리자 > Settings > Variables 메뉴 진입
  - 아래 7개 환경 변수를 등록:
    1. `GOVT_BIZINFO_API_KEY` -- 기업마당 API 키 (`FmSrV3`)
    2. `GOVT_PUBLIC_DATA_KEY` -- 공공데이터포털 API 키 (디코딩 버전, K-Startup/보조금24 공용)
    3. `GEMINI_API_KEY` -- Google AI Studio에서 발급한 Gemini API 키
    4. `TELEGRAM_BOT_TOKEN` -- @Pressco21_bot 토큰 (기존 등록 여부 확인 먼저)
    5. `TELEGRAM_CHAT_ID` -- `7713811206` (기존 등록 여부 확인 먼저)
    6. `AIRTABLE_BASE_ID` -- `app6CynYU5qzIFyKl`
    7. `AIRTABLE_API_KEY` -- Airtable Personal Access Token
  - 기존에 텔레그램/Airtable 자격증명이 등록되어 있으면 재사용 가능 여부 확인
  - Gemini API 키가 없으면 Google AI Studio(aistudio.google.com)에서 신규 발급
  - 공공데이터포털 API 키가 없으면 data.go.kr에서 K-Startup/보조금24 오픈 API 활용 신청
- 완료 기준:
  - [ ] 7개 환경 변수 모두 n8n Variables에 등록됨
  - [ ] 각 변수값이 비어있지 않음 확인
  - [ ] Gemini API 키 유효성 확인 (Google AI Studio 대시보드)
  - [ ] 공공데이터포털 API 키 활용 신청 승인 상태 확인

---

**GS-003: Airtable 테이블 및 스키마 생성**

- 담당 에이전트: `n8n-server-ops`
- 상태: 대기중
- 예상 소요: 30분
- 선행 태스크: GS-002 (AIRTABLE_API_KEY 필요)
- 작업 내용:
  - Airtable 웹(airtable.com)에서 Base `app6CynYU5qzIFyKl` 접속
  - `정부지원공고` 테이블 신규 생성
  - 필드 16개를 PRD 스키마에 맞춰 정확히 생성:

    | 필드명 | 타입 | 비고 |
    |--------|------|------|
    | 공고명 | Single line text | Primary Field |
    | 공고ID | Single line text | 중복 체크 기준 |
    | 수집소스 | Single select | 옵션: 기업마당, K-Startup, 보조금24 |
    | 주관기관 | Single line text | |
    | 지원대상 | Long text | |
    | 지원내용 | Long text | |
    | 지원규모 | Single line text | |
    | 신청시작일 | Date | |
    | 신청마감일 | Date | |
    | 공고URL | URL | |
    | AI점수 | Number | 0~10, 정수 |
    | AI분석이유 | Single line text | |
    | 알림분류 | Single select | 옵션: 긴급검토, 검토권장, 저관련 |
    | 처리상태 | Single select | 옵션: 미검토, 검토중, 신청완료, 미신청, 기간만료 |
    | 담당자메모 | Long text | |
    | 수집일시 | Date | 시간 포함 |

  - Airtable Personal Access Token 발급 또는 기존 토큰 재사용 확인:
    - 권한: `data.records:read`, `data.records:write`
    - Base 범위: `app6CynYU5qzIFyKl`
  - Airtable 뷰 3개 생성:
    1. `미검토 긴급` -- 필터: 처리상태=미검토 AND 알림분류=긴급검토, 정렬: 신청마감일 오름차순
    2. `이번주 마감` -- 필터: 신청마감일 7일 이내, 정렬: 신청마감일 오름차순
    3. `전체 이력` -- 필터 없음, 정렬: 수집일시 내림차순
- 완료 기준:
  - [ ] `정부지원공고` 테이블 생성됨
  - [ ] 16개 필드가 올바른 타입으로 생성됨
  - [ ] Single select 필드의 옵션들이 모두 등록됨
  - [ ] PAT 토큰으로 Airtable API 조회 테스트 성공
  - [ ] 뷰 3개 생성 완료

---

**GS-004: 개별 API 연결 테스트 (기업마당, K-Startup, 보조금24)**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 1시간
- 선행 태스크: GS-002
- 작업 내용:
  - n8n 웹 UI에서 임시 테스트 워크플로우 생성
  - **기업마당 API 테스트**:
    - HTTP Request 노드 추가
    - GET `https://www.bizinfo.go.kr/uss/rss/bizSbizPublicDBList.do`
    - 파라미터: `crtfcKey={{$vars.GOVT_BIZINFO_API_KEY}}`, `dataType=json`, `pageIndex=1`, `searchCnt=10`
    - 응답 확인: `resultCode=0000`, items 배열에 공고 데이터 존재
  - **K-Startup API 테스트**:
    - HTTP Request 노드 추가
    - GET `https://apis.data.go.kr/B490000/openKstartupApiService/getAnnoList`
    - 파라미터: `serviceKey={{$vars.GOVT_PUBLIC_DATA_KEY}}`, `pageNo=1`, `numOfRows=10`, `returnType=JSON`
    - 주의: n8n HTTP Request 노드에서 URL 인코딩 추가 방지 설정 확인
    - 응답 확인: `response.header.resultCode=00`, items 배열 존재
  - **보조금24 API 테스트**:
    - HTTP Request 노드 추가
    - GET `https://apis.data.go.kr/B050015/subsidyService/getSubsidyList`
    - 파라미터: `serviceKey={{$vars.GOVT_PUBLIC_DATA_KEY}}`, `page=1`, `perPage=10`
    - 응답 확인: `data` 배열에 보조금 데이터 존재
  - 각 API 응답 구조를 실제로 확인하고, PRD에 기술된 필드명과 일치하는지 검증
  - 불일치 발견 시 PRD 또는 정규화 코드 수정 필요 사항 기록
- 테스트 체크리스트:
  - [ ] 기업마당 API -- HTTP 200 응답, 공고 목록 배열 수신
  - [ ] K-Startup API -- HTTP 200 응답, 공고 목록 배열 수신
  - [ ] 보조금24 API -- HTTP 200 응답, 보조금 목록 배열 수신
  - [ ] 각 API 응답의 실제 필드명이 PRD와 일치 확인
  - [ ] API 키 인증 오류 없음 확인
  - [ ] 공공데이터포털 키의 인코딩/디코딩 이슈 없음 확인

---

**GS-005: Gemini AI API 연결 테스트**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 30분
- 선행 태스크: GS-002
- 작업 내용:
  - n8n에서 HTTP Request 노드로 Gemini API 단독 테스트
  - POST `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent`
  - Header: `Content-Type: application/json`
  - URL 파라미터: `key={{$vars.GEMINI_API_KEY}}`
  - Body: PRD의 AI 프롬프트를 사용하여 샘플 공고 1건에 대해 분석 요청
  - 응답에서 JSON(`score`, `reason`) 정상 추출 가능한지 확인
  - 응답 형식이 PRD 기대값과 다를 경우 파싱 로직 조정 사항 기록
  - Gemini API 인증 방식 확인: API 키를 URL 파라미터(`key=`) 또는 Header(`Authorization: Bearer`)로 전달하는 두 가지 방식 중 동작하는 방식 확정
- 테스트 체크리스트:
  - [ ] Gemini API HTTP 200 응답 확인
  - [ ] 응답에서 `score` (숫자 0~10)와 `reason` (한국어 문자열) 추출 성공
  - [ ] JSON 파싱이 안정적으로 동작하는지 확인 (마크다운 코드블록 래핑 등 예외 처리)
  - [ ] 무료 티어 Rate Limit 확인 (일 1,500건 이내)
  - [ ] 인증 방식 확정 기록

---

**GS-006: Airtable 및 Telegram 연동 테스트**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 30분
- 선행 태스크: GS-003
- 작업 내용:
  - **Airtable 저장 테스트**:
    - n8n Airtable 노드로 `정부지원공고` 테이블에 테스트 레코드 1건 생성
    - 16개 필드 모두 올바르게 저장되는지 확인
    - 저장 후 Airtable 웹에서 데이터 정상 확인
    - 테스트 레코드 삭제
  - **Airtable 조회 테스트**:
    - `filterByFormula`로 `공고ID` 기준 조회 테스트
    - 중복 체크 로직에 사용할 쿼리: `{공고ID}="TEST-001"` 형태
  - **Telegram 알림 테스트**:
    - n8n Telegram 노드로 테스트 메시지 발송
    - HTML 파싱 모드로 PRD의 긴급 알림 포맷 테스트
    - 기존 n8n Telegram 자격증명 재사용 가능 여부 확인
- 테스트 체크리스트:
  - [ ] Airtable에 레코드 1건 생성 성공
  - [ ] 16개 필드 데이터가 올바른 타입으로 저장됨
  - [ ] `filterByFormula`로 특정 공고ID 조회 성공
  - [ ] Telegram 테스트 메시지 수신 확인
  - [ ] HTML 포맷 (볼드, 링크 등) 정상 렌더링 확인

---

### Phase 1: 핵심 워크플로우 구현

> 목표: 기존 워크플로우 JSON을 n8n에 import하고, 실제 데이터로 전체 파이프라인(수집 -> 정규화 -> 필터링 -> 중복제거 -> AI분석 -> 저장 -> 알림)이 정상 동작하도록 조립 및 검증을 완료한다.

---

**GS-101: 워크플로우 JSON import 및 자격증명 연결** - 우선순위

- 담당 에이전트: `n8n-server-ops`
- 상태: 대기중
- 예상 소요: 30분
- 선행 태스크: GS-001, GS-002, GS-003
- 작업 내용:
  - `govt-support/workflows/정부지원사업_Pressco21.json` 파일을 n8n 웹 UI에서 import
  - import 방법: n8n UI > Workflows > Import from File
  - import 후 각 노드의 자격증명(Credentials) 연결:
    - Airtable 노드들: 기존 `Airtable PAT` 자격증명 연결 (또는 신규 생성)
    - Telegram 노드들: 기존 Telegram Bot API 자격증명 연결
    - HTTP Request 노드들 (기업마당, K-Startup, 보조금24): 환경 변수 참조 확인
    - Gemini HTTP Request 노드: API 키 환경 변수 참조 확인
  - 워크플로우명이 `정부지원사업 자동수집 Pressco21`으로 설정되었는지 확인
  - Schedule Trigger가 올바른 시간(매일 실행)으로 설정되었는지 확인
  - 워크플로우는 아직 Active로 전환하지 않음 (테스트 먼저)
- 완료 기준:
  - [ ] 워크플로우 JSON import 성공
  - [ ] 모든 노드에 빨간색 오류 표시 없음
  - [ ] Airtable 자격증명 연결 완료
  - [ ] Telegram 자격증명 연결 완료
  - [ ] 환경 변수 참조가 올바르게 설정됨
  - [ ] 워크플로우 상태: Inactive (테스트 대기)

---

**GS-102: 데이터 수집 파이프라인 검증 (API 호출 + 정규화 + 병합)**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 1시간
- 선행 태스크: GS-101, GS-004
- 작업 내용:
  - 워크플로우에서 수집 파이프라인 부분만 단독 실행 (노드별 수동 테스트)
  - **기업마당 API 노드** 실행 -> **기업마당 정규화** 노드 실행:
    - 응답 데이터가 공통 스키마(id, title, org, target, content, amount, startDate, endDate, url, source)로 변환되는지 확인
    - 빈 필드, null 값 처리 확인
  - **K-Startup API 노드** 실행 -> **K-Startup 정규화** 노드 실행:
    - 동일 공통 스키마 변환 확인
    - 공공데이터포털 응답 구조(`response.body.items.item`) 파싱 정상 확인
  - **보조금24 API 노드** 실행 -> **보조금24 정규화** 노드 실행:
    - 동일 공통 스키마 변환 확인
    - 보조금24 특유의 `data` 배열 파싱 정상 확인
  - **3개 API 통합** (Merge 노드) 실행:
    - 3개 소스의 정규화된 데이터가 단일 배열로 병합되는지 확인
    - 총 건수 기록
  - 정규화 코드에서 실제 API 응답과 불일치하는 필드가 있으면 Code 노드 수정
- 테스트 체크리스트:
  - [ ] 기업마당 정규화 결과: 공통 스키마 10개 필드 모두 존재
  - [ ] K-Startup 정규화 결과: 공통 스키마 10개 필드 모두 존재
  - [ ] 보조금24 정규화 결과: 공통 스키마 10개 필드 모두 존재
  - [ ] Merge 노드 결과: 3개 소스 데이터가 하나의 배열로 합쳐짐
  - [ ] null/undefined 필드 없이 안정적으로 변환됨

---

**GS-103: 필터링 및 중복 제거 파이프라인 검증**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 1시간
- 선행 태스크: GS-102
- 작업 내용:
  - **사전 필터링 노드** 검증:
    - 지역 필터: title 또는 target에 `서울`, `전국`, `수도권` 포함하는 공고만 통과
    - 제외 업종: target에 `농업`, `어업`, `축산`, `임업`만 포함된 공고 제거
    - 마감일 필터: endDate가 오늘 이전인 공고 제거
    - 필터 통과 전후 건수 비교 로깅
  - **기존 공고ID 조회** (Airtable 노드) 검증:
    - Airtable에서 기존 공고ID 목록을 조회하는 로직 확인
    - 비어있는 테이블에서도 오류 없이 동작하는지 확인
  - **중복제거 & 신규필터** 노드 검증:
    - 이미 Airtable에 존재하는 공고ID를 가진 건을 제거
    - 첫 실행 시(Airtable 비어있을 때) 모든 건이 신규로 통과하는지 확인
  - 필터링 조건이 너무 엄격하거나 너무 느슨하지 않은지 실제 데이터로 확인
- 테스트 체크리스트:
  - [ ] 사전 필터링: 서울/전국 외 지역 공고가 제거됨
  - [ ] 사전 필터링: 농업/어업/축산/임업 전용 공고가 제거됨
  - [ ] 사전 필터링: 마감일 지난 공고가 제거됨
  - [ ] 중복 체크: Airtable 조회가 오류 없이 동작
  - [ ] 중복 체크: 이미 저장된 공고ID는 건너뜀
  - [ ] 필터 전후 건수가 합리적인 범위 (전체의 30~70% 통과)

---

**GS-104: AI 분석 파이프라인 검증 (Gemini 호출 + 응답 파싱 + 점수 분류)**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 1시간 30분
- 선행 태스크: GS-103, GS-005
- 작업 내용:
  - **회사정보 조회/통합** 노드 동작 확인 (Airtable에서 회사 프로파일 조회 또는 하드코딩)
  - **Gemini 프롬프트 생성** 노드 검증:
    - 공고 데이터가 프롬프트 템플릿에 올바르게 삽입되는지 확인
    - PRD의 AI 프롬프트가 정확히 사용되는지 확인 (회사 정보, 출력 형식 포함)
  - **Gemini 분석** (HTTP Request) 노드 검증:
    - Loop Over Items 내에서 1건씩 순차 처리되는지 확인
    - Wait 노드로 Rate Limit 방지 (건 사이 딜레이) 확인
    - 실제 공고 3~5건으로 테스트 실행
  - **Gemini 응답 파싱** 노드 검증:
    - JSON 응답에서 `score`와 `reason` 정상 추출
    - Gemini가 마크다운 코드블록(```json ... ```)으로 감싸서 응답할 경우의 파싱 처리
    - score가 숫자가 아닌 경우 예외 처리 (-1 할당)
    - 파싱 실패 시 `AI점수=-1`, `AI분석이유="분석실패"` 기본값 처리
  - **관련도 분기** (IF/Switch 노드) 검증:
    - score >= 7: 긴급검토 경로
    - score 4~6: 검토권장 경로
    - score 0~3: 저관련 경로 (Airtable 저장만)
    - score = -1 (분석실패): 저관련과 동일 경로
- 테스트 체크리스트:
  - [ ] Gemini 프롬프트에 공고 정보가 올바르게 삽입됨
  - [ ] Gemini API 호출 성공 (HTTP 200)
  - [ ] 응답에서 score(숫자)와 reason(문자열) 정상 추출
  - [ ] score 기준 3개 경로(긴급/검토/저관련) 분기 정상 동작
  - [ ] 분석 실패 시 기본값(-1) 처리 정상 동작
  - [ ] Rate Limit 방지 Wait 노드 동작 확인

---

**GS-105: Airtable 저장 및 Telegram 알림 파이프라인 검증**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 1시간
- 선행 태스크: GS-104, GS-006
- 작업 내용:
  - **Airtable 저장 노드** 검증 (고관련/검토/저관련 각 경로):
    - 저장 노드가 올바른 테이블(`정부지원공고`)과 Base에 연결되었는지 확인
    - 16개 필드 매핑이 정확한지 확인
    - `처리상태`가 기본값 `미검토`로 저장되는지 확인
    - `수집일시`에 현재 시각이 자동 입력되는지 확인
    - 중복 저장 방지: 같은 공고ID로 재실행 시 업데이트(update) 경로로 분기하는지 확인
  - **Telegram 긴급 알림 노드** 검증:
    - HTML 파싱 모드로 PRD 포맷에 맞는 메시지 발송
    - 볼드, 링크, 이모지 정상 렌더링
    - 마감일까지 남은 일수 계산 정상 확인
  - **Telegram 검토 알림 노드** 검증:
    - 검토권장 포맷으로 메시지 발송
    - 긴급 알림과 포맷 차이 확인
  - **Loop Over Items** 내 알림 순서 확인:
    - 고관련(7+) 공고는 개별 긴급 알림 발송
    - 검토(4~6) 공고는 개별 검토 알림 발송
    - 저관련(0~3) 공고는 알림 없이 저장만
- 테스트 체크리스트:
  - [ ] Airtable에 공고 레코드 저장 성공 (16개 필드)
  - [ ] 처리상태 기본값 `미검토` 확인
  - [ ] 수집일시에 현재 시각 자동 입력 확인
  - [ ] Telegram 긴급 알림 수신 및 포맷 정상
  - [ ] Telegram 검토 알림 수신 및 포맷 정상
  - [ ] 저관련 공고는 알림 없이 저장만 됨 확인

---

**GS-106: 일일 수집 요약 알림 구현 및 검증**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 45분
- 선행 태스크: GS-105
- 작업 내용:
  - 워크플로우 끝에 일일 수집 요약 알림 노드가 존재하는지 확인
  - 없으면 추가 구현:
    - 전체 Loop 완료 후 집계 Code 노드 추가
    - 집계 항목: 총 신규 수집 건수, 긴급검토 건수, 검토권장 건수, 저관련 건수, 중복 제외 건수
    - 집계 결과를 PRD의 일일 요약 포맷으로 Telegram 발송
  - 수집 건수가 0건인 경우에도 "오늘 신규 공고 없음" 메시지 발송
  - Airtable 전체 보기 링크 포함 확인
- 테스트 체크리스트:
  - [ ] 전체 실행 완료 후 요약 알림 Telegram 수신
  - [ ] 긴급/검토/저관련 건수가 실제와 일치
  - [ ] 총 건수 및 중복 제외 건수 정확
  - [ ] Airtable 링크 클릭 시 정상 접속
  - [ ] 0건일 때도 정상 메시지 발송

---

### Phase 2: 전체 통합 테스트 및 오류 처리

> 목표: 워크플로우 전체를 수동 실행하여 End-to-End 정상 동작을 확인하고, 오류 처리 로직을 보강하여 무인 운영이 가능한 수준으로 완성한다.

---

**GS-201: End-to-End 수동 실행 테스트** - 우선순위

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 1시간
- 선행 태스크: GS-106
- 작업 내용:
  - n8n UI에서 워크플로우 전체를 수동 실행 (Test Execution)
  - 실행 결과를 노드별로 확인:
    - Schedule Trigger -> API 3개 병렬 호출 -> 정규화 3개 -> Merge -> 필터링 -> 중복제거 -> Loop(Gemini -> 파싱 -> 분기 -> 저장 -> 알림) -> 요약 알림
  - 전체 파이프라인에서 오류 발생 노드 식별 및 수정
  - Airtable에 실제 데이터 저장 확인 (웹에서 직접 확인)
  - Telegram에 알림 수신 확인
  - 실행 시간 측정 (전체 소요 시간)
  - Playwright MCP로 n8n UI 접속하여 실행 이력 확인
- 테스트 체크리스트:
  - [ ] 전체 워크플로우 오류 없이 완료
  - [ ] 3개 API 모두 데이터 수집 성공
  - [ ] 필터링 후 합리적인 건수 통과
  - [ ] Airtable에 신규 공고 레코드 저장됨
  - [ ] AI점수별 알림분류가 올바르게 설정됨
  - [ ] Telegram 긴급/검토 알림 정상 수신
  - [ ] 일일 요약 알림 정상 수신
  - [ ] 전체 실행 시간 10분 이내

---

**GS-202: 중복 실행 검증 (멱등성 테스트)**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 30분
- 선행 태스크: GS-201
- 작업 내용:
  - GS-201 실행 직후 동일 워크플로우를 한 번 더 수동 실행
  - 중복 제거 로직이 정상 동작하여 이미 저장된 공고가 재저장되지 않는지 확인
  - Airtable 레코드 수가 첫 실행과 동일한지 확인
  - 두 번째 실행의 일일 요약에서 "신규 0건" 또는 매우 적은 건수 표시
  - 중복 공고에 대해 Telegram 알림이 재발송되지 않는지 확인
- 테스트 체크리스트:
  - [ ] 두 번째 실행 시 Airtable 레코드 중복 저장 없음
  - [ ] 일일 요약에서 신규 건수 0건 (또는 실제 신규분만)
  - [ ] 중복 공고에 대한 Telegram 재알림 없음
  - [ ] 기존 레코드의 데이터가 변조되지 않음

---

**GS-203: 오류 처리 로직 보강 및 검증**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 1시간
- 선행 태스크: GS-201
- 작업 내용:
  - PRD 오류 처리 설계에 따라 각 노드에 Error Handling 추가:
    - **API 응답 실패 (타임아웃/5xx)**:
      - 각 HTTP Request 노드에 `Continue On Fail` 설정
      - 실패한 소스는 건너뛰고 나머지 소스 계속 진행
      - 정규화 노드에서 빈 입력 처리 (빈 배열 반환)
    - **Gemini API 실패**:
      - HTTP Request 노드에 `Continue On Fail` 설정
      - 파싱 노드에서 실패 감지 시 `AI점수=-1`, `AI분석이유="분석실패"` 할당
      - 분석 실패 건은 알림 없이 Airtable 저장만
    - **Gemini JSON 파싱 실패**:
      - 응답 텍스트에서 정규식으로 숫자 추출 시도
      - 실패 시 -1 처리
    - **Airtable 저장 실패**:
      - 저장 노드에 `Continue On Fail` 설정
      - 실패 건은 Telegram으로 오류 알림 후 다음 건 계속
    - **Telegram 알림 실패**:
      - Telegram 노드에 `Continue On Fail` 설정
      - 저장은 완료된 상태이므로 무시 (Airtable에서 확인)
  - n8n Settings > Execution에서 워크플로우 실패 시 기본 오류 알림 설정
- 테스트 체크리스트:
  - [ ] API 1개 실패 시 나머지 2개 소스는 정상 수집
  - [ ] Gemini 실패 시 AI점수=-1로 저장됨
  - [ ] Airtable 저장 실패 시 다음 건 계속 처리
  - [ ] Telegram 실패 시 워크플로우 전체가 중단되지 않음
  - [ ] n8n 실행 오류 알림 설정 완료

---

### Phase 3: 운영 안정화 및 자동 스케줄 배포

> 목표: 스케줄 트리거를 활성화하여 매일 자동 실행을 시작하고, 2주간 안정 운영을 확인한다.

---

**GS-301: 스케줄 활성화 및 첫 자동 실행 확인** - 우선순위

- 담당 에이전트: `n8n-server-ops`
- 상태: 대기중
- 예상 소요: 30분 (설정 5분 + 다음날 확인 25분)
- 선행 태스크: GS-201, GS-202, GS-203
- 작업 내용:
  - n8n UI에서 워크플로우 Active 토글 ON
  - Schedule Trigger 시간 확인: 매일 09:00 (워크플로우 JSON 기준, PRD의 07:00과 차이 있음 -- 확인 후 결정)
  - 다음날 스케줄 실행 후 확인:
    - n8n 실행 이력에서 성공 여부 확인
    - Airtable에 신규 레코드 추가됨 확인
    - Telegram 알림 수신 확인
    - 실행 시간 및 처리 건수 기록
- 완료 기준:
  - [ ] 워크플로우 Active 상태
  - [ ] 스케줄 시간 확정 (07:00 또는 09:00)
  - [ ] 첫 자동 실행 성공 확인 (n8n 실행 이력)
  - [ ] Airtable 신규 레코드 확인
  - [ ] Telegram 알림 정상 수신

---

**GS-302: 1주차 운영 모니터링**

- 담당 에이전트: `n8n-server-ops`
- 상태: 대기중
- 예상 소요: 매일 5분 x 7일
- 선행 태스크: GS-301
- 작업 내용:
  - 7일간 매일 확인 항목:
    - n8n 실행 이력: 성공/실패 여부
    - Airtable: 매일 신규 레코드 추가되는지
    - Telegram: 알림 정상 수신되는지
    - AI 점수 분포: 너무 높거나 낮은 경향 없는지
  - 문제 발생 시 즉시 대응:
    - API 인증 만료 → 키 갱신
    - Rate Limit 초과 → 수집량 조정
    - 서버 다운 → Docker 재시작
  - 1주차 종료 시 운영 리포트 작성:
    - 총 수집 건수, 알림 건수, 실패 건수
    - AI 점수 평균 및 분포
    - 필터링 효율 (통과율)
- 완료 기준:
  - [ ] 7일간 매일 자동 실행 성공 (실패 0~1회 이내)
  - [ ] Airtable에 매일 신규 레코드 추가됨
  - [ ] Telegram 알림이 유용하다는 사용자 피드백
  - [ ] AI 점수 분포가 합리적 (0~3점이 다수, 7+ 소수)
  - [ ] 1주차 운영 리포트 작성 완료

---

**GS-303: 2주차 운영 모니터링 및 튜닝**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 매일 5분 x 7일 + 튜닝 2시간
- 선행 태스크: GS-302
- 작업 내용:
  - 2주차 모니터링 (GS-302와 동일한 일일 확인)
  - 1주차 운영 데이터 기반 튜닝:
    - **AI 프롬프트 개선**: 점수가 부정확한 사례가 있으면 프롬프트 조정
    - **필터링 조건 조정**: 너무 많은 공고가 통과하면 필터 강화, 너무 적으면 완화
    - **알림 포맷 개선**: 사용자 피드백 반영하여 메시지 포맷 조정
  - 마감된 공고 처리:
    - Airtable에서 신청마감일이 지난 공고의 처리상태를 `기간만료`로 일괄 변경
    - (수동 또는 별도 자동화 워크플로우 검토)
  - Gemini API 사용량 확인 (Google AI Studio 대시보드)
  - Phase 2 확장 준비 여부 판단
- 완료 기준:
  - [ ] 2주간 안정 운영 확인 (일일 실패율 5% 미만)
  - [ ] AI 프롬프트 튜닝 완료 (필요 시)
  - [ ] 사용자가 알림 품질에 만족
  - [ ] 마감 공고 처리 프로세스 확립
  - [ ] Phase 2 확장 진행 여부 결정

---

### Phase 4: 확장 기능 구현 (Phase 1 안정 운영 2주 후)

> 목표: 추가 수집 소스(고용24, 소진공)를 연동하고, 마감 임박 재알림 및 월간 리포트 기능을 구현하여 시스템 활용도를 높인다.

---

**GS-401: 고용24 API 추가 연동**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 3시간
- 선행 태스크: GS-303
- 작업 내용:
  - 고용24 API 조사 및 키 발급:
    - API 엔드포인트, 인증 방식, 응답 구조 파악
    - 필요 시 공공데이터포털 또는 고용노동부에서 API 활용 신청
  - n8n 워크플로우에 고용24 노드 추가:
    - HTTP Request 노드 추가 (기존 3개 API와 병렬)
    - 고용24 정규화 Code 노드 추가 (공통 스키마 변환)
    - Merge 노드에 4번째 입력 추가
  - Airtable `수집소스` Single select에 `고용24` 옵션 추가
  - 테스트 실행 및 데이터 확인
- 테스트 체크리스트:
  - [ ] 고용24 API 호출 성공
  - [ ] 정규화 결과가 공통 스키마와 일치
  - [ ] 기존 3개 소스와 병합 정상
  - [ ] Airtable에 수집소스=고용24로 저장됨
  - [ ] 기존 워크플로우 동작에 영향 없음

---

**GS-402: 소진공 API 추가 연동**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 3시간
- 선행 태스크: GS-303
- 작업 내용:
  - 소상공인진흥공단 API 조사 및 키 발급:
    - API 엔드포인트, 인증 방식, 응답 구조 파악
    - 소진공 전용 API 또는 공공데이터포털 경유 여부 확인
  - n8n 워크플로우에 소진공 노드 추가:
    - HTTP Request 노드 추가 (기존 API들과 병렬)
    - 소진공 정규화 Code 노드 추가
    - Merge 노드에 입력 추가
  - Airtable `수집소스` Single select에 `소진공` 옵션 추가
  - 테스트 실행 및 데이터 확인
- 테스트 체크리스트:
  - [ ] 소진공 API 호출 성공
  - [ ] 정규화 결과가 공통 스키마와 일치
  - [ ] 기존 소스들과 병합 정상
  - [ ] Airtable에 수집소스=소진공으로 저장됨
  - [ ] 기존 워크플로우 동작에 영향 없음

---

**GS-403: 마감 임박 재알림 워크플로우 구현**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 2시간
- 선행 태스크: GS-303
- 작업 내용:
  - **별도 워크플로우** 신규 생성 (기존 수집 워크플로우와 분리)
  - 워크플로우명: `정부지원사업_마감임박_재알림`
  - 로직:
    1. Schedule Trigger: 매일 09:00 (수집 워크플로우 완료 후)
    2. Airtable 조회: `AI점수 >= 7` AND `처리상태 = 미검토` AND `신청마감일 3일 이내`
    3. 해당 건에 대해 Telegram 재알림:
       ```
       (경고) 마감 임박! (D-{{남은일수}})
       {{공고명}}
       마감일: {{신청마감일}}
       AI 적합도: {{AI점수}}점
       ```
    4. 마감일 지난 공고는 처리상태를 `기간만료`로 자동 업데이트
  - 기존 수집 워크플로우와의 충돌 방지 확인
- 테스트 체크리스트:
  - [ ] 마감 3일 이내 + 미검토 + 7점 이상 공고 정상 조회
  - [ ] 재알림 Telegram 메시지 정상 수신
  - [ ] 마감일 경과 공고의 처리상태 자동 변경
  - [ ] 기존 수집 워크플로우와 독립적으로 동작

---

**GS-404: 월간 신청 현황 리포트 구현**

- 담당 에이전트: `n8n-workflow-builder`
- 상태: 대기중
- 예상 소요: 2시간
- 선행 태스크: GS-303
- 작업 내용:
  - **별도 워크플로우** 신규 생성
  - 워크플로우명: `정부지원사업_월간리포트`
  - 로직:
    1. Schedule Trigger: 매월 1일 10:00
    2. Airtable 조회: 지난 달 수집된 전체 레코드
    3. Code 노드로 집계:
       - 총 수집 건수
       - 알림분류별 건수 (긴급/검토/저관련)
       - 처리상태별 건수 (신청완료/미신청/미검토/기간만료)
       - 수집소스별 건수
       - AI 점수 평균
    4. Telegram 월간 리포트 발송:
       ```
       (차트) {{월}}월 정부지원사업 월간 리포트

       총 수집: {{총건수}}건
       긴급검토: {{긴급}}건 | 검토권장: {{검토}}건 | 저관련: {{저관련}}건

       신청완료: {{신청완료}}건
       미신청: {{미신청}}건
       미검토: {{미검토}}건
       기간만료: {{만료}}건

       수집소스: 기업마당 {{A}}건, K-Startup {{B}}건, 보조금24 {{C}}건
       AI 평균 점수: {{평균}}점
       ```
- 테스트 체크리스트:
  - [ ] Airtable에서 월별 데이터 조회 성공
  - [ ] 집계 수치가 정확
  - [ ] Telegram 월간 리포트 메시지 정상 수신
  - [ ] 매월 1일 자동 실행 스케줄 설정 확인

---

## 관련 파일 목록

```
govt-support/
  PRD.md                                        # 정부지원사업 자동수집 시스템 PRD (설계 문서)
  ROADMAP.md                                     # 이 파일 (개발 로드맵)
  workflows/
    정부지원사업_Pressco21.json                    # n8n 워크플로우 JSON (import 대기)
  tasks/                                          # 태스크별 상세 작업 문서 (생성 예정)
    GS-001-server-check.md
    GS-002-env-variables.md
    ...
```

## 변경 이력

| 날짜 | 변경 내용 | 작성자 |
|------|----------|--------|
| 2026-02-24 | 초기 로드맵 작성 | development-planner |
